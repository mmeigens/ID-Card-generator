<!DOCTYPE html>
<html>
<head>
    <title>Student ID Card Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/jsbarcode.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-color: #f3f4f6;
        }

        .form-container {
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .form-container h2 {
            margin-bottom: 20px;
            color: #1f2937;
        }

        .form-container input[type="text"],
        .form-container input[type="tel"],
        .form-container input[type="file"] {
            width: calc(100% - 20px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        .form-container input[type="text"]:focus,
        .form-container input[type="tel"]:focus,
        .form-container input[type="file"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
        }

        .form-container input[type="file"] {
            padding-top: 8px;
        }

        #id-picture-preview {
            max-width: 150px;
            display: block;
            margin: 15px auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            width: 100%;
        }

        .card {
            border: 2px solid #e0e0e0;
            padding: 20px;
            width: 320px;
            position: relative;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            background-color: #ffffff;
            background-size: cover;
            background-position: center;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .card img {
            max-width: 120px;
            display: block;
            margin: 0 auto 15px;
            border-radius: 8px;
        }

        .card-info {
            text-align: left;
            color: #4a5568;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .card-info p {
            margin-bottom: 8px;
            font-size: 18px;
            width: 100%;
            display: flex;
            align-items: baseline;
            gap: 5px;
            line-height: 0.5;
        }

        .card-info strong {
            color: #1a202c;
            margin-right: 5px;
        }

        #preview-container {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }

        #download-section {
            margin-top: 30px;
            text-align: center;
            display: none;
            width: 90%;
            max-width: 400px;
        }

        #download-section input[type="text"] {
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            width: calc(100% - 20px);
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        #download-section button {
            padding: 12px 25px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s ease;
            width: 100%;
            opacity: 0.5;
            pointer-events: none;
        }

        #download-section button:hover {
            background-color: #45a049;
        }

        .design-button {
            margin: 5px;
            padding: 10px 20px;
            border: 2px solid #3b82f6;
            background-color: white;
            color: #3b82f6;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 16px;
        }

        .design-button:hover {
            background-color: #3b82f6;
            color: white;
        }

        .design-button.active {
            background-color: #3b82f6;
            color: white;
        }

        #logo-preview {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .barcode-container {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }

        .barcode-container svg {
            width: 100px;
            height: 30px;
        }

        .shape-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            opacity: 0.8;
            animation: moveShapes 20s infinite linear;
        }

        .shape1 {
            width: 50px;
            height: 50px;
            top: 10%;
            left: 20%;
            animation-delay: 0s;
        }
        .shape2 {
            width: 80px;
            height: 80px;
            top: 30%;
            left: 60%;
            animation-delay: 5s;
        }
        .shape3 {
            width: 30px;
            height: 30px;
            top: 70%;
            left: 15%;
            animation-delay: 10s;
        }
        .shape4 {
            width: 60px;
            height: 60px;
            top: 60%;
            left: 80%;
            animation-delay: 15s;
        }
        .shape5 {
            width: 40px;
            height: 40px;
            top: 85%;
            left: 40%;
            animation-delay: 2s;
        }

        @keyframes moveShapes {
            0% {
                transform: translateY(0) translateX(0);
            }
            100% {
                transform: translateY(100vh) translateX(100vw);
            }
        }

    </style>
    <script>
        // Function to generate barcode (moved to be included before generateCard())
        function generateBarcode(text, elementId) {
            JsBarcode(#${elementId}, text, {
                format: "CODE128",
                displayValue: true,
                width: 2,
                height: 30,
                textMargin: 2,
                fontSize: 10,
            });
        }
    </script>
</head>
<body>

    <div class="form-container">
        <div id="logo-preview" style="width: 100px; height: 100px; border-radius: 50%; background-color: blue; color: white; font-size: 24px; display: flex; justify-content: center; align-items: center; margin: 0 auto 0px;">GEM</div>
        <h2 style="margin-bottom: 0.1em;">God Embassy Ministries</h2>
        <input type="file" id="id-picture" accept="image/*" onchange="previewImage(this, 'id-picture-preview')">
        <img id="id-picture-preview" style="display:none;">
        <input type="text" id="first-name" placeholder="First Name">
        <input type="text" id="last-name" placeholder="Last Name">
        <input type="text" id="phone" placeholder="Phone Number">
        <input type="text" id="blood-type" placeholder="Blood Type">
        <input type="text" id="address" placeholder="Address">
        <input type="hidden" id="class-name" value="Systematic Theology">
        <p style="font-size: 16px; color: #4a5568; margin-bottom: 15px;">Choose your preferred design, click to download your card, and print it out.</p>
        <button id="generate-card-button" onclick="generateCard()">Generate Card</button>
        <p id="error-message" style="color: red; margin-top: 10px;"></p>
    </div>

    <div class="card-container" id="preview-container">
        </div>

    <div id="download-section" style="display: none;">
        <input type="text" id="payment-code" placeholder="Enter your payment code to download">
        <button id="download-button" onclick="downloadCard()">Download Card</button>
    </div>

    <script>
        const correctPaymentCode = "ABC123";
        let generatedCards = [];
        let selectedDesign = null;

        function generateCard() {
            console.log("Generate Card button clicked");
            const firstName = document.getElementById("first-name").value;
            const lastName = document.getElementById("last-name").value;
            const phone = document.getElementById("phone").value;
            const bloodType = document.getElementById("blood-type").value;
            const address = document.getElementById("address").value;
            const className = document.getElementById("class-name").value;
            const idPictureFile = document.getElementById("id-picture").files[0];
            const errorMessage = document.getElementById("error-message");


            if (!firstName || !lastName || !phone || !bloodType || !address || !idPictureFile) {
                errorMessage.textContent="Please fill in all fields and upload an ID picture.";
                return;
            }
             errorMessage.textContent = "";

            const studentCode = firstName.substring(0, 2).toUpperCase() + phone.slice(-4);

            const reader = new FileReader();
            reader.onload = function (event) {
                const imageDataUrl = event.target.result;
                document.getElementById("id-picture-preview").src = imageDataUrl;
                document.getElementById("id-picture-preview").style.display = "block";

                generatedCards = generateAllDesigns(imageDataUrl, firstName, lastName, phone, bloodType, address, studentCode, className);
                displayPreviews();
                document.getElementById("download-section").style.display = "none";
                selectedDesign = null;
            };
            reader.readAsDataURL(idPictureFile);
        }



        function generateAllDesigns(imageDataUrl, firstName, lastName, phone, bloodType, address, studentCode, className) {
            const designs = [
                {
                    background: 'linear-gradient(to bottom right, #f0f4c3, #d4e157)',
                    textColor: '#1a202c',
                    shapes: [
                        { class: 'shape1', style: 'background-color: rgba(255, 255, 255, 0.3); width: 60px; height: 60px; top: 15%; left: 10%; animation-delay: 0s; border-radius: 50%;' },
                        { class: 'shape2', style: 'background-color: rgba(255, 255, 255, 0.3); width: 90px; height: 90px; top: 40%; left: 70%; animation-delay: 3s; border-radius: 50%;' },
                        { class: 'shape6', style: 'background-color: rgba(255, 255, 255, 0.3); width: 50px; height: 50px; top: 25%; left: 50%; animation-delay: 1s; border-radius: 0%;' },
                    ]
                },
                {
                    background: 'linear-gradient(to bottom right, #b0e0e6, #48d1cc)',
                    textColor: '#1a202c',
                    shapes: [
                        { class: 'shape3', style: 'background-color: rgba(255, 255, 255, 0.3); width: 40px; height: 40px; top: 60%; left: 25%; animation-delay: 6s; border-radius: 50%;' },
                        { class: 'shape4', style: 'background-color: rgba(255, 255, 255, 0.3); width: 70px; height: 70px; top: 20%; left: 50%; animation-delay: 9s; border-radius: 50%;' },
                        { class: 'shape7', style: 'background-color: rgba(255, 255, 255, 0.3); width: 60px; height: 60px; top: 80%; left: 10%; animation-delay: 8s; border-radius: 0%;' },
                    ]
                },
                {
                    background: 'linear-gradient(to bottom right, #ffebcd, #ffc300)',
                    textColor: '#1a202c',
                    shapes: [
                        { class: 'shape1', style: 'background-color: rgba(255, 255, 255, 0.3); width: 55px; height: 55px; top: 80%; left: 30%; animation-delay: 12s; border-radius: 50%;' },
                        { class: 'shape5', style: 'background-color: rgba(255, 255, 255, 0.3); width: 45px; height: 45px; top: 5%; left: 85%; animation-delay: 15s; border-radius: 50%;' },
                        { class: 'shape8', style: 'background-color: rgba(255, 255, 255, 0.3); width: 75px; height: 75px; top: 45%; left: 20%; animation-delay: 11s; border-radius: 0%;' },
                    ]
                },
                {
                    background: 'linear-gradient(to bottom right, #87cefa, #ffd700)',
                    textColor: '#1a202c',
                    shapes: [
                        { class: 'shape2', style: 'background-color: rgba(255, 255, 255, 0.3); width: 85px; height: 85px; top: 35%; left: 15%; animation-delay: 18s; border-radius: 50%;' },
                        { class: 'shape4', style: 'background-color: rgba(255, 255, 255, 0.3); width: 65px; height: 65px; top: 75%; left: 65%; animation-delay: 21s; border-radius: 50%;' },
                        { class: 'shape9', style: 'background-color: rgba(255, 255, 255, 0.3); width: 55px; height: 55px; top: 10%; left: 60%; animation-delay: 20s; border-radius: 0%;' },
                    ]
                },
                {
                    background: '#f0f0f0',
                    textColor: '#1a202c',
                    shapes: []
                }
            ];

            const commonCardContent = `
                <div style="width: 100px; height: 100px; border-radius: 50%; background-color: blue; color: white; font-size: 24px; display: flex; justify-content: center; align-items: center; margin: 0 auto 0px;">GEM</div>
                <p style="font-size: 18px; font-weight: bold; margin-bottom: 0.1em; text-align: center; color: #00008B; line-height: 1.2;">God Embassy Ministries</p>
                <div class="card-info" style="text-align: left;">
                    <img src="${imageDataUrl}" alt="Student Photo" style="max-width: 110px; border-radius: 6px; margin-bottom: 10px;">
                    <p style="line-height: 0.5;"><strong>Name:</strong> <span>${firstName} ${lastName}</span></p>
                    <p style="line-height: 0.5;"><strong>Phone:</strong> <span>${phone}</span></p>
                    <p style="line-height: 0.5;"><strong>Blood:</strong> <span>${bloodType}</span></p>
                    <p style="line-height: 0.5;"><strong>Address:</strong> <span>${address}</span></p>
                    <p style="line-height: 0.5;"><strong>Class:</strong> <span>${className}</span></p>
                    <p style="text-align: right; line-height: 0.5;"><strong>Code:</strong> <span>${studentCode}</span></p>
                </div>
                <div class="barcode-container" id="barcode-container-${studentCode}">
                    <svg id="barcode-${studentCode}"></svg>
                </div>
            `;

            return designs.map(design => {
                const shapesHtml = design.shapes.map(shape => <div class="${shape.class}" style="${shape.style}"></div>).join('');
                return `<div class="card selectable-card" style="position: relative; background-image: ${design.background}; color: ${design.textColor}; cursor: pointer; overflow: hidden;">
                            ${commonCardContent}
                            <div class="shape-container">
                                ${shapesHtml}
                            </div>
                        </div>`;
            });
        }

        function displayPreviews() {
            const previewContainer = document.getElementById("preview-container");
            previewContainer.innerHTML = "";
            generatedCards.forEach((cardHtml, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.innerHTML = cardHtml;
                const designButton = document.createElement('button');
                designButton.classList.add('design-button');
                designButton.textContent = Design ${index + 1};
                designButton.addEventListener('click', () => {
                    selectedDesign = index;
                    document.querySelectorAll('.design-button').forEach(b => b.classList.remove('active'));
                    designButton.classList.add('active');
                    enableDownloadButton();
                });
                cardDiv.appendChild(designButton);

                cardDiv.querySelector('.card').addEventListener('click', () => {
                    selectedDesign = index;
                    document.querySelectorAll('.design-button').forEach(b => b.classList.remove('active'));
                    designButton.classList.add('active');
                    enableDownloadButton();
                });

                previewContainer.appendChild(cardDiv);
            });
            if (generatedCards.length > 0) {
                selectedDesign = 0;
                const firstDesignButton = previewContainer.querySelector('.design-button');
                if (firstDesignButton) {
                    firstDesignButton.classList.add('active');
                }
            }
            previewContainer.style.display = "flex";

            generatedCards.forEach((cardHtml, index) => {
                const studentCode = document.getElementById('first-name').value.substring(0, 2).toUpperCase() + document.getElementById('phone').value.slice(-4);
                generateBarcode(studentCode, barcode-${studentCode});
            });
        }

        function enableDownloadButton() {
            const downloadButton = document.getElementById("download-button");
            downloadButton.style.opacity = 1;
            downloadButton.style.pointerEvents = "auto";
            document.getElementById("download-section").style.display = "block";
        }

        function downloadCard() {
            const enteredPaymentCode = document.getElementById("payment-code").value;

            if (enteredPaymentCode === correctPaymentCode) {
                if (selectedDesign !== null) {
                    const cardHtml = generatedCards[selectedDesign];
                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = cardHtml;
                    const cardElement = tempDiv.firstChild;

                    html2canvas(cardElement).then(canvas => {
                        const link = document.createElement("a");
                        link.href = canvas.toDataURL("image/jpeg");
                        link.download = "student_id_card.jpg";
                        link.click();
                        document.getElementById("payment-code").value = "";
                        document.getElementById("download-section").style.display = "none";
                        selectedDesign = null;
                    });
                } else {
                    alert("Please select a card design to download.");
                }
            } else {
                alert("Incorrect payment code.");
            }
        }

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            const reader = new FileReader();

            reader.onloadend = function () {
                preview.src = reader.result;
                preview.style.display = "block";
            };

            if (file) {
                reader.readAsDataURL(file);
            } else {
                preview.src = "";
                preview.style.display = "none";
            }
        }


    </script>
</body>
</html>



